!function(t,i){var e=function(t,i){this._init(t,i)};e.prototype={constructor:e,_init:function(i,e){var o=this;this.$element=t(i),this.options=t.extend(!0,{},t.fn.cytoscapeNavigator.defaults,e),o.$element.cytoscape(function(){o.cy=o.$element.cytoscape("get"),o.boundingBox=o.cy.elements().boundingBox(),o._initPanel(),o._initThumbnail(),o._initView(),o._initOverlay()}),this.width=this.$element.width(),this.height=this.$element.height()},destroy:function(){this.$panel.remove(),this.$element.removeData("navigator")},_initPanel:function(){var i=this.options;if(i.container)if(i.container instanceof jQuery){if(!(i.container.length>0))return void t.error("Container for jquery.cyNavigator is empty");this.$panel=i.container.first()}else{if(!(t(i.container).length>0))return void t.error("There is no any element matching your selector for jquery.cyNavigator");this.$panel=t(i.container).first()}else this.$panel=t('<div class="cytoscape-navigator"/>'),t("body").append(this.$panel);this._setupPanel(),this.cy.on("resize",t.proxy(this.resize,this))},_setupPanel:function(){this.options;this.panelWidth=this.$panel.width(),this.panelHeight=this.$panel.height()},_initThumbnail:function(){this.$thumbnail=t("<canvas/>"),this.$panel.append(this.$thumbnail),this._setupThumbnailSizes(),this._setupThumbnail(),this.cy.on("initrender",t.proxy(this._checkThumbnailSizesAndUpdate,this)),this.options.thumbnailLiveFramerate===!1?this._hookGraphUpdates():this._setGraphUpdatesTimer()},_setupThumbnail:function(){this._thumbnailSetup||(this.$thumbnail.attr("width",this.panelWidth),this.$thumbnail.attr("height",this.panelHeight),this._thumbnailSetup=!0),this._updateThumbnailImage()},_setupThumbnailSizes:function(){this.boundingBox=this.cy.elements().boundingBox(),this.thumbnailZoom=Math.min(this.panelHeight/this.boundingBox.h,this.panelWidth/this.boundingBox.w),this.thumbnailPan={x:(this.panelWidth-this.thumbnailZoom*(this.boundingBox.x1+this.boundingBox.x2))/2,y:(this.panelHeight-this.thumbnailZoom*(this.boundingBox.y1+this.boundingBox.y2))/2}},_checkThumbnailSizesAndUpdate:function(){var t=this.thumbnailZoom,i=this.thumbnailPan.x,e=this.thumbnailPan.y;this._setupThumbnailSizes(),t!=this.thumbnailZoom||i!=this.thumbnailPan.x||e!=this.thumbnailPan.y?(this._setupThumbnail(),this._setupView()):this._updateThumbnailImage()},_initView:function(){this.$view=t('<div class="cytoscape-navigatorView"/>'),this.$panel.append(this.$view),this.viewBorderTop=parseInt(this.$view.css("border-top-width"),10),this.viewBorderRight=parseInt(this.$view.css("border-right-width"),10),this.viewBorderBottom=parseInt(this.$view.css("border-bottom-width"),10),this.viewBorderLeft=parseInt(this.$view.css("border-left-width"),10),this.viewBorderHorizontal=this.viewBorderLeft+this.viewBorderRight,this.viewBorderVertical=this.viewBorderTop+this.viewBorderBottom,this._setupView(),this.cy.on("zoom pan",t.proxy(this._setupView,this))},_setupView:function(){if(!this.viewLocked){var t=this.cy.zoom(),i=this.cy.pan();this.viewW=this.width/t*this.thumbnailZoom,this.viewX=-i.x*this.viewW/this.width+this.thumbnailPan.x-this.viewBorderLeft,this.viewH=this.height/t*this.thumbnailZoom,this.viewY=-i.y*this.viewH/this.height+this.thumbnailPan.y-this.viewBorderTop,this.$view.width(this.viewW).height(this.viewH).css({left:this.viewX,top:this.viewY})}},_initOverlay:function(){this.$overlay=t('<div class="cytoscape-navigatorOverlay"/>'),this.$panel.append(this.$overlay),this.overlayHookPointX=0,this.overlayHookPointY=0,this._initEventsHandling()},resize:function(){this.width=this.$element.width(),this.height=this.$element.height(),this._thumbnailSetup=!1,this._setupPanel(),this._checkThumbnailSizesAndUpdate(),this._setupView()},_initEventsHandling:function(){var i=this,e=["mousedown","mousewheel","DOMMouseScroll","touchstart"],o=["mouseup","mouseout","mousemove","touchmove","touchend"];this.$overlay.on(e.join(" "),function(e){if("touchstart"==e.type&&(e.offsetX=i.viewX+i.viewW/2,e.offsetY=i.viewY+i.viewH/2),void 0===e.offsetX||void 0===e.offsetY){var o=t(e.target).offset();e.offsetX=e.pageX-o.left,e.offsetY=e.pageY-o.top}return"mousedown"==e.type||"touchstart"==e.type?i._eventMoveStart(e):("mousewheel"==e.type||"DOMMouseScroll"==e.type)&&i._eventZoom(e),!1}),t(window).on(o.join(" "),function(e){if(i.overlayInMovement){if("touchend"==e.type?(e.offsetX=i.viewX+i.viewW/2,e.offsetY=i.viewY+i.viewH/2):"touchmove"==e.type&&(e.pageX=e.originalEvent.touches[0].pageX,e.pageY=e.originalEvent.touches[0].pageY),void 0===e.offsetX||void 0===e.offsetY){var o=t(e.target).offset();e.offsetX=e.pageX-o.left,e.offsetY=e.pageY-o.top}if(e.target!==i.$overlay[0]){var o=t(e.target).offset(),s=i.$overlay.offset();e.offsetX=e.offsetX-s.left+o.left,e.offsetY=e.offsetY-s.top+o.top}return"mousemove"==e.type||"touchmove"==e.type?i._eventMove(e):("mouseup"==e.type||"touchend"==e.type)&&i._eventMoveEnd(e),!1}})},_eventMoveStart:function(t){var i=(new Date).getTime();this.overlayLastMoveStartTime&&this.overlayLastMoveStartTime+this.options.dblClickDelay>i?(this.overlayLastMoveStartTime=0,this.overlayInMovement=!0,this.overlayHookPointX=this.viewW/2,this.overlayHookPointY=this.viewH/2,this.options.viewLiveFramerate!==!1?this._eventMove({offsetX:this.panelWidth/2,offsetY:this.panelHeight/2}):this._eventMoveEnd({offsetX:this.panelWidth/2,offsetY:this.panelHeight/2}),this.overlayInMovement=!1):(this.overlayLastMoveStartTime=i,this.overlayInMovement=!0,this.viewLocked=!0,t.offsetX>=this.viewX&&t.offsetX<=this.viewX+this.viewW&&t.offsetY>=this.viewY&&t.offsetY<=this.viewY+this.viewH?(this.overlayHookPointX=t.offsetX-this.viewX,this.overlayHookPointY=t.offsetY-this.viewY):(this.overlayHookPointX=this.viewW/2,this.overlayHookPointY=this.viewH/2,this._eventMove(t)))},_eventMove:function(t){var i=this;this._checkMousePosition(t),this.overlayInMovement&&(this.viewX=t.offsetX-this.overlayHookPointX,this.viewY=t.offsetY-this.overlayHookPointY,this.$view.css("left",this.viewX),this.$view.css("top",this.viewY),this.options.viewLiveFramerate!==!1&&(0==this.options.viewLiveFramerate?this._moveCy():this.overlayTimeout||(this.overlayTimeout=setTimeout(function(){i._moveCy(),i.overlayTimeout=!1},1e3/this.options.viewLiveFramerate))))},_checkMousePosition:function(t){t.offsetX>this.viewX&&t.offsetX<this.viewX+this.viewBorderHorizontal+this.viewW&&t.offsetY>this.viewY&&t.offsetY<this.viewY+this.viewBorderVertical+this.viewH?this.$panel.addClass("mouseover-view"):this.$panel.removeClass("mouseover-view")},_eventMoveEnd:function(t){this.viewLocked=!1,this.$panel.removeClass("mouseover-view"),this.overlayInMovement&&(this._eventMove(t),this.options.viewLiveFramerate===!1&&this._moveCy(),this.overlayInMovement=!1)},_eventZoom:function(t){var i=Math.pow(10,t.originalEvent.wheelDeltaY/1e3||t.originalEvent.wheelDelta/1e3||t.originalEvent.detail/-32),e={left:t.offsetX,top:t.offsetY};this.cy.zoomingEnabled()&&this._zoomCy(i,e)},_hookGraphUpdates:function(){this.cy.on("position add remove data",t.proxy(this._checkThumbnailSizesAndUpdate,this,!1))},_setGraphUpdatesTimer:function(){var t=1e3/this.options.thumbnailLiveFramerate,i=this,e=function(){setTimeout(function(){i._checkThumbnailSizesAndUpdate(!0),e()},t)};e()},_updateThumbnailImage:function(t){var i=this;if(!this._thumbnailUpdating){this._thumbnailUpdating=!0;var e=function(){var t=i.$thumbnail[0],o=t.getContext("2d"),s=i.panelWidth,n=i.panelHeight,h=i.boundingBox,a=Math.min(s/h.w,n/h.h),r=1,v={x:(s-a*(h.x1+h.x2))/2,y:(n-a*(h.y1+h.y2))/2};o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,s,n),i.cy.renderTo(o,a,v,r),cytoscape.util.requestAnimationFrame(e)};cytoscape.util.requestAnimationFrame(e)}},_moveCy:function(){this.cy.pan({x:-(this.viewX+this.viewBorderLeft-this.thumbnailPan.x)*this.width/this.viewW,y:-(this.viewY+this.viewBorderLeft-this.thumbnailPan.y)*this.height/this.viewH})},_zoomCy:function(t,i){var e;e={x:this.width/2,y:this.height/2},this.cy.zoom({level:this.cy.zoom()*t,renderedPosition:e})}},t.fn.cytoscapeNavigator=function(i){var o=arguments;return this.each(function(){var s=t(this),n=s.data("navigator"),h="object"==typeof i&&i;n||s.data("navigator",n=new e(this,h)),"string"==typeof i&&(void 0===n[i]?t.error("cyNavigator has no such method"):"function"!=typeof n[i]?t.error("cyNavigator."+i+" is not a function"):"_"==i.charAt(0)?t.error("cyNavigator."+i+" is a private function"):n[i].call(n,Array.prototype.slice.call(o,1)))})},t.fn.cytoscapeNavigator.Constructor=e,t.fn.cytoscapeNavigator.defaults={container:!1,viewLiveFramerate:0,thumbnailEventFramerate:30,thumbnailLiveFramerate:!1,dblClickDelay:200},t.fn.cyNavigator=t.fn.cytoscapeNavigator,i("core","navigator",function(i){var e=this;t(e.container()).cytoscapeNavigator(i)})}(jQuery,cytoscape);